Dragon Knight
Changelog


Dragon Knight 1.1.12  (06.29.2017) by Kesstryl (updated 12.29.2021)
All changes to vanilla code were done to increase security and make code php 7 compatible.
Security changes are not exaustive, add your own to increase security, or use at your own risk.
php 7 code upgrades
- changed database type from MyIsam to InnoDB in install.php
- Changed mysql to mysqli for all database commands throughout code.
- defined variables wherever they were undefined.
Security changes
- changed password hashing to use the native PHP password_hash function which is based on Bcrypt.
- changed cookies to use a hash code which is changed at every login.
- set cookies to http only.
- changed cookies to last for one week instead of one year to force new cookie tokens and reduce chances of session hijacking.
- added htaccess files in all folders to prevent directory snooping.
- added a session token that is accessible from the database so user is not logged out until cookie expires.
- added http_user_agent to sessions to check that every cookie request comes from the same user.
- added a function to check for host url to protect against csfr wherever POST and GET are used. This will throw an error if logged in through cookies and not the login form, but the error goes away once you do something.
- added a token hidden field in POST forms in admin panel to protect against csfr.
- changed admin.php to go back to the index page if unauthorized to use the admin panel.
- changed hash algorithm for passwords from md5 to sha256.
- added a salt to passwords.
- added a string sanitize function and implemented it wherever there is POST data.
- added an array sanitize function and implemented it wherever there is GET data.
- added an array sanitize function and implemented it where POST and $_GET data is extracted as an array.
- EXTR_SKIP has been added to the extract global $_POST as an extra security measure.
- libxml_disable_entity_loader set to true in the xml variable to prevent xml entity expansion attacks. 
- added a verification captcha to registration and lost password - code by Greg Smith (xanderman from the old dk forums).
- added a verification captcha to appear on a second failed login attempt to reduce brute force attacks.
- added a hidden field in registration to prevent spam registration.
- added security headers to lib.php
- removed alphanumeric limitation to passwords, and increased password size to 120 so users can create stronger passwords if they wish. 
Additional changes
- added the top ten mod created by renderse7en from the DK mods forums because he created this engine and also wrote the mod.
- added an extra folder with mods and instructions for installing the mods.  Included mods have been updated to mysqli with security added, and tested to work with 1.1.12
Outstanding Bug Fixed
- Users leveled all the way to 100 would get reset to zero because an else condition was missing for characters that reached 100.  This has now been added.  All mods have had this fix added where applicable.

### 1.1.11 (3.26.2006) ###
### Thanks to r0xes & Adam. :)
- Added recursive htmlspecialchars to the rest of the superglobal security in lib.php.
- Fixed a bug that allowed blank passwords.
- Updated copyright dates as necessary.

### 1.1.10b (10.25.2005) ###
- Fixed addslashes_deep() to actually add slashes, instead of strip them. Man, I'm dumb.

### 1.1.10a (10.1.2005) ###
### Thanks to obliv. :)
- Fixed a security error.

### 1.1.10 (3.13.2005) ###
### Thanks to Gary13579. :)
- Fixed a security error.
- Added verified/banned checking in the built-in forum.

### 1.1.9 (3.2.2005) ###
### Thanks to xudzh and ChAoS and Adam. :)
- Character names now have validation checking.
- Fixed babblebox bug when used in Internet Exploder.
- Updated the admin menu link to the main game page for the new path.
- Updated the link to the official DK forums in the Help file.

### 1.1.8 (2.6.2005) ###
- Added extra security to prevent SQL injection exploits.
- admin.php is now in the game root directory rather than the /admin/ sub.

### 1.1.7 (12.29.2004) ###
### Thanks to Adam. :)
- Fixed URL cheat that allowed people to continue fighting after victory.

### 1.1.6a (11.20.2004) ###
- Fixed problem where goldbonus was added to experience instead of gold.
- Fixed a typo in fight.php.

### 1.1.6 (11.6.2004) ###
### Thanks to Shadowbq, joshman, Adam, and Tsufo. :)
- Fixed variable name reference in fight.php.
- Fixed URL cheat that allowed people to buy any item from any town.
- Fixed URL cheat that allowed people to travel anywhere without having the map.
- Fixed display bug in the error messages generated by cheat attempts.
- Fixed admin/editlevels that caused all level values to be reset to zero.

### 1.1.5 (9.22.2004) ###
### Thanks to Adam and Shadowbq. :)
- Fixed Travel To cheat that allowed you to escape from fights.

### 1.1.4 (8.23.2004) ###
### Thanks to Gary13579 and Maebius. :)
- Fixed URL cheat that allowed people to get healed for free.
- Changes to make babblebox more secure from html/bbcode exploits.

### 1.1.3a (5.23.2004) ###
- Updated forum.php for use with new checkcookies() location.

### 1.1.3 (5.20.2004) ###
- Fixed several bugs related small bugs related to new version info location.
- Moved checkcookies() out of login.php, into cookies.php.
- Deleted admin/lib.php, moved requisite functions into standard lib.php.
- Fixed minor display bug in admin template.

### 1.1.2 (4.24.2004) ###
- Fixed bug with default spell/town field contents.
- Fixed bug with updating new spell on levelup.
- Updated help file to point to new forums address.
- Version info is now handled through lib.php, instead of config.php.

### 1.1.1 (3.1.2004) ###
- Fixed map buying bug.
- Fixed adminemail bug when sending email (tnx Mantagnana).

### 1.1.0 (2.27.2004) ###
### Thanks to Miker, Yop, Mantagnana & Maebius for bug reports & feature ideas. :)
- Added option to verify registration emails.
- Added options to turn off display of news/online/babblebox in towns.
- Added gameurl and adminemail fields to control table.
- Added ability to ban a user without deleting the account.
- Added rules for passwords (alphanumeric, maxlength=10).
- Added page where users can change their passwords.
- Added a page for lost passwords.
- Fixed bugs in users.php to use doquery() instead of mysql_query().
- Fixed bug in installer program when creating the admin user account.
- Changed the way towns and spells are handled in the user account.
- Removed some deprecated code from the onlinechar() function.

### 1.0.4 (2.14.2004) ###
### Thanks to Maebius & Mantagnana. :)
- Fixed babblebox bug.
- More checks to ensure experience/gold doesn't go over the database field limit.
- Fixed bug with dropcode and levelups.
- Added visual warning if your exp/gold are maxed out.
- Fixed minor experience bug in Extended Character Stats.
- Fixed minor display bug in admin template.

### 1.0.3 (2.6.2004) ###
### Thanks to Maebius for reporting these. :)
- Fixed problem with monster's turn in fight.php
- Once again tried to fix the paths bug, this time by eliminating it altogether.

### 1.0.2 (2.4.2004) ###
### Thanks to WolfSinger for reporting these. :)
- Fixed bug in installer that prevented it from working with MySQL 3.
- Fixed more bugs with random number generation.
- Hopefully fixed problem with paths on some systems. New variable in lib.php.

### 1.0.1 (1.29.2004) ###
- Added basic map popup.
- Added optional "call home" function to installer.
- Added checker to ensure install.php has been deleted before running.

### Final (1.24.2004) ###
- Added installer script.
- Added news posting to control panel.
- General cleanup, etc.

### RC2 (1.20.2004) ###
- A few more minor template changes.
- Fixed missing spells list in fight screen.
- Added ability to see character stats for Who's Online people.
- Added "Next Level" experience points in Extended Stats popup.
- Completely new and finalized Help section.

### RC1 Aero (1.16.2004) ###
- Fixed database to allow floats in difficulty mods.
- A couple minor template changes.
- Fixed bug that prevented med/hard difficulties from gaining experience.
- Fixed several small bugs with random number generation.
- Dying is now integrated into the fight screen for better user feedback.
- Fixed bug that allowed victory gold/experience exploit.
- Added internal forums.
- Added some admin options.
- Added user auth level (user/admin).
- Added Admin Control Panel.
- Fixed bug that allowed users to post blank messages in babblebox.
- Added option to close game during maintanence.
- Added administration control panel.

### Beta 3 Aqua (12.18.2003) ###
- Fixed problem with red status bars not showing up sometimes.
- Added control settings table for changing major game options.
- Altered several little chunks to accept values from controlrow instead of hard coding.
- Other minor changes to pull away from the hard-coded "Dragon Knight" name.
- Changes to map buying screen to include town coordinates.
- Added shoutbox + safety features to main town screen.
- Added Who's Online to main town screen.
- Added News box to main town screen.
- Picking a monster when a fight starts is now more efficient.
- Monsters now have a chance to get the first swing.
- Monsters now have a chance to block you from running away.

### Beta 2 Fira (12.14.2003) ###
- Fixed bug with special items to keep you from having more than your max HP/MP/TP when you get rid of the item.
- Fixed death so you now get back 25% of your HP.
- Added monster item drops.
- Rebalanced town TP price.
- Added TP price to map purchasing screen.
- Added output compression to save bandwidth.
- Added new HP/MP/TP status bars in rightnav.
- Rewrote explore.php to be more efficient & to help with the IE problem.
- Fixed buyback of old items to use whole numbers instead of fractions.
- Fixed IE problem that prevented/fuxx0r'd movement.

### Beta 1 Terra (11.22.2003) ###
- Complete engine rewrite. Numerous new features.

### Alpha 1 (9.19.2003) ###
- Initial public release.